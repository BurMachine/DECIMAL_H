#include<stdio.h>
#include <string.h>
#include <math.h>
#include "s21_decimal.h"
#define TRUE  1
#define FALSE  0
#define s21_ok 0
#define s21_convert_error 1
static const char *const binary_powers_of_ten[29] = {
    [0] =
        "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001",
    [1] =
        "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001010",
    [2] =
        "000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001100100",
    [3] =
        "000000000000000000000000000000000000000000000000000000000000000000000000000000000000001111101000",
    [4] =
        "000000000000000000000000000000000000000000000000000000000000000000000000000000000010011100010000",
    [5] =
        "000000000000000000000000000000000000000000000000000000000000000000000000000000011000011010100000",
    [6] =
        "000000000000000000000000000000000000000000000000000000000000000000000000000011110100001001000000",
    [7] =
        "000000000000000000000000000000000000000000000000000000000000000000000000100110001001011010000000",
    [8] =
        "000000000000000000000000000000000000000000000000000000000000000000000101111101011110000100000000",
    [9] =
        "000000000000000000000000000000000000000000000000000000000000000000111011100110101100101000000000",
    [10] =
        "000000000000000000000000000000000000000000000000000000000000001001010100000010111110010000000000",
    [11] =
        "000000000000000000000000000000000000000000000000000000000001011101001000011101101110100000000000",
    [12] =
        "000000000000000000000000000000000000000000000000000000001110100011010100101001010001000000000000",
    [13] =
        "000000000000000000000000000000000000000000000000000010010001100001001110011100101010000000000000",
    [14] =
        "000000000000000000000000000000000000000000000000010110101111001100010000011110100100000000000000",
    [15] =
        "000000000000000000000000000000000000000000000011100011010111111010100100110001101000000000000000",
    [16] =
        "000000000000000000000000000000000000000000100011100001101111001001101111110000010000000000000000",
    [17] =
        "000000000000000000000000000000000000000101100011010001010111100001011101100010100000000000000000",
    [18] =
        "000000000000000000000000000000000000110111100000101101101011001110100111011001000000000000000000",
    [19] =
        "000000000000000000000000000000001000101011000111001000110000010010001001111010000000000000000000",
    [20] =
        "000000000000000000000000000001010110101111000111010111100010110101100011000100000000000000000000",
    [21] =
        "000000000000000000000000001101100011010111001001101011011100010111011110101000000000000000000000",
    [22] =
        "000000000000000000000010000111100001100111100000110010011011101010110010010000000000000000000000",
    [23] =
        "000000000000000000010101001011010000001011000111111000010100101011110110100000000000000000000000",
    [24] =
        "000000000000000011010011110000100001101111001110110011001110110110100001000000000000000000000000",
    [25] =
        "000000000000100001000101100101010001011000010100000000010100100001001010000000000000000000000000",
    [26] =
        "000000000101001010110111110100101101110011001000000011001101001011100100000000000000000000000000",
    [27] =
        "000000110011101100101110001111001001111111010000100000000011110011101000000000000000000000000000",
    [28] =
        "001000000100111111001110010111100011111000100101000000100110000100010000000000000000000000000000",
};

void print01(int i, int szf) {
    while (szf--) {
        printf("%d", (i >> szf) & 1 );
    }
}

void print0001(s21_decimal a) {
    print01(a.bits[3], 32);
    printf(" ");
    print01(a.bits[2], 32);
    printf(" ");
    print01(a.bits[1], 32);
    printf(" ");
    print01(a.bits[0], 32);
}

s21_decimal get_power_of_ten(int pow) {
    s21_decimal result = {0};
    set_scale(&result, 0);
    for (int i = 0; i < 96; ++i) {
        if (binary_powers_of_ten[pow][95 - i] == '1') {
            set_bit(&result, 1, i);
        } else {
            set_bit(&result, 0, i);
        }
    }
    return result;
}

int s21_floor(s21_decimal value, s21_decimal *result) {
     int sign = get_sign(&value);
    memset(result, 0, sizeof(*result));
    int never_error = 0;

  s21_decimal one = get_power_of_ten(0);
  s21_decimal zero = {0};
  s21_decimal mod_res = {0};

  s21_mod(value, one, &mod_res);
  s21_truncate(value, result);

  if (get_sign(&value) && s21_is_not_equal(value, zero)  && s21_is_not_equal(mod_res, zero)) {
    *result = bit_add(result, &one, &never_error);
  }

    set_sign(result, sign);

    return s21_ok;
}

// int s21_round(s21_decimal value, s21_decimal *result) {
//   int valid_value = TRUE;
//   s21_decimal res = {0, 0, 0, 0};
//   s21_decimal one = {1, 0, 0, 0};
//   s21_decimal five = {5, 0, 0, 0};
//   int sign = get_sign(&value);
//   set_sign(&value, 0);
//   s21_decimal trunc = s21_truncate(value, result);
//   s21_decimal buf = s21_sub(value, trunc);
//   set_scale(&five, 1);
//   if (valid_value) {
//     res = trunc;
//     if (s21_is_greater_or_equal(buf, five) == TRUE) {
//       res = s21_add(res, one);
//     }
//     set_sign(&res, sign);
//   } else {
//     res.value_type = dec1.value_type;
//   }
//   return res;
// }


int main() {
    // int d1 = 2147483650;
    // s21_decimal val_d1;
    // s21_from_int_to_decimal(d1, &val_d1);
    // print0001(val_d1);
    // printf("\n");
    // int d2;
    // s21_decimal val_d2 = {101, 1, 0, 0};
    // s21_from_decimal_to_int(val_d2, &d2);
    // printf("%d\n", d2);
    // float f1;
    // s21_decimal val_f1 = {121, 0, 0, 0};
    // set_scale(&val_f1, 3);
    // print0001(val_f1);
    // printf("\n");
    // s21_from_decimal_to_float(val_f1, &f1);
    // printf("%.5f\n", f1);
    // float f2 = 345423.3242;
    // s21_decimal val_f2;
    // s21_from_float_to_decimal(f2, &val_f2);
    // print0001(val_f2);
    // printf("\n");
   // s21_decimal c = {0, 0, 0, 0};
    // s21_decimal num1 = {16, 0, 0, 0};
    // s21_decimal num2 = {1, 0, 0, 0};
//    set_bit(&num1, 95, 1);
//    set_bit(&num2, 95, 1);
   // set_scale(&num1, 4);
//    set_scale(&num2, 1);
//    set_sign(&num2, 1);
//    scale_equalize(&num1, &num2);
//    s21_add(num1, num2, &c);
//    print0001(num1);
    // printf("\n");
    // print0001(num2);
    // printf("\n");
    // print0001(c);
    // printf("\n");
    // printf("%d\n%d", get_scale(&num1), get_scale(&num2));
 s21_decimal f1 = {132, 0, 0, 0};
 set_scale(&f1, 1);
 s21_decimal f2;
 s21_floor(f1, &f2);
    print0001(f1);
    printf("\n");
    print0001(f2);
    printf("\n");
}
